<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Registration</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    html, body {
        height: 100%;
        margin: 0;
    }

    body {
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f9fa;
    }

    .logo {
      font-size: 2.5rem;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      letter-spacing: 2px;
      text-transform: uppercase;
      text-align: center;
      margin-bottom: 1.5rem;
    }

    .logo span.pay {
      color: #002f8d;
    }

    .logo span.peer {
      color: #0d6efd;
    }

    .form-signin {
        max-width: 400px;
        margin: auto;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .form-signin .form-floating:focus-within {
        z-index: 2;
    }

    .form-signin input[type="text"],
    .form-signin input[type="password"],
    .form-signin input[type="email"] {
        margin-bottom: -1px;
        border-radius: 0;
    }

    .form-signin input[type="password"],
    .form-signin input[type="email"] {
        margin-bottom: 10px;
    }

    .is-invalid ~ .invalid-feedback {
        display: block;
    }

    .input-group .form-control {
        border-radius: 0;
    }

    .input-group .form-select {
        border-radius: 0;
        max-width: 90px;
        padding-right: 1.75rem;
        background-position: right 0.5rem center;
    }

    .input-group.phone-group {
        margin-bottom: -1px;
    }

    .form-select option {
        font-size: 1.2rem;
    }
  </style>
</head>
<body>
<main class="form-signin w-100 m-auto">
  <form method="post" action="/register" class="needs-validation" novalidate>
    <h1 class="logo"><span class="pay">PAY</span><span class="peer">PEER</span></h1>
    <h1 class="h3 mb-3 fw-normal">Registration</h1>

    <div th:if="${error}" class="text-danger mb-3" th:text="${error}"></div>

    <div class="form-floating">
      <input type="text" class="form-control" id="floatingFullName" name="fullName" placeholder="Full Name" required>
      <label for="floatingFullName">Full Name <span class="text-danger">*</span></label>
      <div class="invalid-feedback">
        Please enter your full name.
      </div>
    </div>

    <div class="input-group phone-group">
      <select class="form-select" id="countryCode" name="countryCode" required>
        <option value="" disabled selected>Code</option>
        <option value="+7">ðŸ‡·ðŸ‡º +7</option>
        <option value="+1">ðŸ‡ºðŸ‡¸ +1</option>
        <option value="+44">ðŸ‡¬ðŸ‡§ +44</option>
        <option value="+49">ðŸ‡©ðŸ‡ª +49</option>
        <option value="+33">ðŸ‡«ðŸ‡· +33</option>
        <option value="+81">ðŸ‡¯ðŸ‡µ +81</option>
        <option value="+86">ðŸ‡¨ðŸ‡³ +86</option>
        <option value="+91">ðŸ‡®ðŸ‡³ +91</option>
        <option value="+55">ðŸ‡§ðŸ‡· +55</option>
        <option value="+61">ðŸ‡¦ðŸ‡º +61</option>
        <option value="+39">ðŸ‡®ðŸ‡¹ +39</option>
        <option value="+34">ðŸ‡ªðŸ‡¸ +34</option>
        <option value="+82">ðŸ‡°ðŸ‡· +82</option>
        <option value="+971">ðŸ‡¦ðŸ‡ª +971</option>
        <option value="+27">ðŸ‡¿ðŸ‡¦ +27</option>
        <option value="+52">ðŸ‡²ðŸ‡½ +52</option>
        <option value="+41">ðŸ‡¨ðŸ‡­ +41</option>
        <option value="+31">ðŸ‡³ðŸ‡± +31</option>
        <option value="+46">ðŸ‡¸ðŸ‡ª +46</option>
        <option value="+90">ðŸ‡¹ðŸ‡· +90</option>
      </select>
      <div class="form-floating">
        <input type="text" class="form-control" id="floatingPhoneNumber" name="phoneNumber" placeholder="Phone Number" required>
        <label for="floatingPhoneNumber">Phone Number <span class="text-danger">*</span></label>
      </div>
      <div class="invalid-feedback">
        Please select a country code and enter a valid phone number.
      </div>
    </div>

    <div class="form-floating">
      <input type="password" class="form-control" id="floatingPassword" name="password" placeholder="Password" required>
      <label for="floatingPassword">Password <span class="text-danger">*</span></label>
      <div class="invalid-feedback">
        Please enter a password.
      </div>
    </div>

    <div class="form-floating">
      <input type="email" class="form-control" id="floatingEmail" name="email" placeholder="Email (optional)">
      <label for="floatingEmail">Email (optional)</label>
      <div class="invalid-feedback">
        Please enter a valid email.
      </div>
    </div>

    <button class="btn btn-primary w-100 py-2" type="submit">Register</button>
    <p class="mt-5 mb-3 text-muted text-center">Â© 2025</p>
  </form>
</main>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/inputmask@5.0.8/dist/inputmask.min.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const phoneInput = document.getElementById('floatingPhoneNumber');
    const countryCodeSelect = document.getElementById('countryCode');
    let inputMask;

    function updatePhoneMask() {
      phoneInput.value = '';

      const countryCode = countryCodeSelect.value;
      let mask;

      switch (countryCode) {
        case '+7':
          mask = '+7 (999) 999-99-99'; // Russia
          break;
        case '+1':
          mask = '+1 (999) 999-9999'; // USA/Canada
          break;
        case '+44':
          mask = '+44 9999 999999'; // UK
          break;
        case '+49':
          mask = '+49 999 99999999'; // Germany
          break;
        case '+33':
          mask = '+33 9 99 99 99 99'; // France
          break;
        case '+81':
          mask = '+81 90-9999-9999'; // Japan
          break;
        case '+86':
          mask = '+86 999 9999 9999'; // China
          break;
        case '+91':
          mask = '+91 99999 99999'; // India
          break;
        case '+55':
          mask = '+55 99 99999-9999'; // Brazil
          break;
        case '+61':
          mask = '+61 4 999 999 999'; // Australia
          break;
        case '+39':
          mask = '+39 999 999 9999'; // Italy
          break;
        case '+34':
          mask = '+34 999 999 999'; // Spain
          break;
        case '+82':
          mask = '+82 10-9999-9999'; // South Korea
          break;
        case '+971':
          mask = '+971 50 999 9999'; // UAE
          break;
        case '+27':
          mask = '+27 99 999 9999'; // South Africa
          break;
        case '+52':
          mask = '+52 999 999 9999'; // Mexico
          break;
        case '+41':
          mask = '+41 99 999 99 99'; // Switzerland
          break;
        case '+31':
          mask = '+31 6 99999999'; // Netherlands
          break;
        case '+46':
          mask = '+46 70 999 99 99'; // Sweden
          break;
        case '+90':
          mask = '+90 999 999 99 99'; // Turkey
          break;
        default:
          mask = '999999999999999'; // Fallback for unlisted countries
      }

      if (inputMask) {
        inputMask.remove();
      }
      inputMask = Inputmask({
        mask: mask,
        showMaskOnHover: false,
        showMaskOnFocus: true,
        placeholder: "_",
      }).mask(phoneInput);
    }

    updatePhoneMask();

    countryCodeSelect.addEventListener('change', updatePhoneMask);

    const form = document.querySelector('.needs-validation');
    form.addEventListener('submit', function (event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');

      const countryCode = countryCodeSelect.value;
      let phoneNumber = phoneInput.value.replace(/[^+\d]/g, '');

      if (countryCode === '+7') {
        phoneNumber = phoneNumber.replace(/^\+7/, '+7');
      }

      const normalizedPhoneInput = document.createElement('input');
      normalizedPhoneInput.type = 'hidden';
      normalizedPhoneInput.name = 'normalizedPhoneNumber';
      normalizedPhoneInput.value = phoneNumber;
      form.appendChild(normalizedPhoneInput);
    });
  });
</script>
</body>
</html>